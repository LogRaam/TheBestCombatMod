// Code written by Gabriel Mailhot, 28/08/2023.

#region

using TaleWorlds.MountAndBlade;
using TheBestCombatMod.Concept;

#endregion

namespace TheBestCombatMod.Features.KnockedDown.Options
{
   public class KnockedDownBodyPartVulnerabilityOptions : BodyPartsVulnerabilityOptions
   {
      public const int Unknown = 0;
      private readonly string[] _loadedOptions;

      public KnockedDownBodyPartVulnerabilityOptions(in string[] loadedOptions)
      {
         _loadedOptions = loadedOptions;
         Update();
      }

      public int Abdomen { get; set; }
      public int Arms { get; set; }
      public int Chest { get; set; }
      public int Head { get; set; }
      public int Legs { get; set; }
      public int Neck { get; set; }
      public int Shoulders { get; set; }

      public int Convert(string textTag)
      {
         var t = textTag.ToLower();

         return t switch
         {
            "unknown" => Unknown,
            "abdomen" => Abdomen,
            "arms" => Arms,
            "chest" => Chest,
            "head" => Head,
            "legs" => Legs,
            "neck" => Neck,
            "shoulders" => Shoulders,
            "shoulderleft" => Shoulders,
            "shoulderright" => Shoulders,
            "armleft" => Arms,
            "armright" => Arms,
            _ => 0
         };
      }

      public int Convert(in BoneBodyPartType blowVictimBodyPart)
      {
         return blowVictimBodyPart switch
         {
            BoneBodyPartType.None => Unknown,
            BoneBodyPartType.Head => Head,
            BoneBodyPartType.Neck => Neck,
            BoneBodyPartType.Chest => Chest,
            BoneBodyPartType.Abdomen => Abdomen,
            BoneBodyPartType.ShoulderLeft => Shoulders,
            BoneBodyPartType.ShoulderRight => Shoulders,
            BoneBodyPartType.ArmLeft => Arms,
            BoneBodyPartType.ArmRight => Arms,
            BoneBodyPartType.Legs => Legs,
            BoneBodyPartType.NumOfBodyPartTypes => Unknown,
            _ => 0
         };
      }

      public void Update()
      {
         if (_loadedOptions.Length == 0) return;

         var loader = Runtime.Get.ConfigurationLoader;
         var option = Runtime.Get.KnockedDownByBlowOptionReader;

         Abdomen = loader.RetrieveIntegerValueFrom(_loadedOptions, option.KnockedDownValues.KnockedDown_Sensitivity_For_Abdomen_xxxx_Value);
         Arms = loader.RetrieveIntegerValueFrom(_loadedOptions, option.KnockedDownValues.KnockedDown_Sensitivity_For_Arms_xxxx_Value);
         Chest = loader.RetrieveIntegerValueFrom(_loadedOptions, option.KnockedDownValues.KnockedDown_Sensitivity_For_Chest_xxxx_Value);
         Head = loader.RetrieveIntegerValueFrom(_loadedOptions, option.KnockedDownValues.KnockedDown_Sensitivity_For_Head_xxxx_Value);
         Legs = loader.RetrieveIntegerValueFrom(_loadedOptions, option.KnockedDownValues.KnockedDown_Sensitivity_For_Legs_xxxx_Value);
         Neck = loader.RetrieveIntegerValueFrom(_loadedOptions, option.KnockedDownValues.KnockedDown_Sensitivity_For_Neck_xxxx_Value);
         Shoulders = loader.RetrieveIntegerValueFrom(_loadedOptions, option.KnockedDownValues.KnockedDown_Sensitivity_For_Shoulders_xxxx_Value);
      }
   }
}